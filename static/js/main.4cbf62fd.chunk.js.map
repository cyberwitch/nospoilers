{"version":3,"sources":["tvmaze/tvmaze.ts","step-one/episode-picker.tsx","step-one/season-picker.tsx","step-one/show-picker.tsx","step-one/step-one.tsx","step-two/browser.tsx","step-two/step-two.tsx","wikimedia/wikimedia.ts","App.tsx","index.tsx"],"names":["PatchedTvmaze","shows","episodes","id","specials","queryString","Promise","resolve","reject","request","get","apiEndpoint","json","err","response","body","Tvmaze","tvmaze","EpisodePicker","props","state","isLoading","results","fetchEpisodes","bind","onChange","clearButton","this","labelKey","formatEpisodeName","options","renderMenuItemChildren","episode","episodeName","image","src","medium","alt","selected","seasonNumber","season","episodeNumber","number","name","show","toString","setState","seasonEpisodes","then","nextSeason","episodebynumber","firstEpsiodeNextSeason","finally","undefined","catch","length","nextEpisodeIndex","indexOf","prevProps","React","Component","SeasonPicker","fetchSeasons","filterBy","formatSeasonName","seasonName","filter","namePart","join","seasons","nextSeasonIndex","ShowPicker","query","onSearch","search","map","StepOne","onSubmit","Jumbotron","Form","Group","Label","onEpisodeChange","renderSeasonPicker","renderEpisodePicker","renderNextButton","nextEpisode","Button","type","e","preventDefault","onNextClick","Browser","html","dangerouslySetInnerHTML","__html","wiki","getPage","page","oldid","JSON","parse","text","endpoint","rp","uri","qs","origin","action","list","srsearch","format","title","before","prop","titles","rvprop","rvstart","rvlimit","StepTwo","pages","Fragment","Alert","variant","Control","value","target","submitted","renderTabs","Tabs","Tab","key","eventKey","loading","searchResponse","forEach","date","Date","airstamp","setDate","getDate","getRevision","toISOString","getRevisionResponse","revisions","Object","keys","concat","revid","App","activeKey","onSelect","disabled","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.4cbf62fd.chunk.js","sourcesContent":["import request from \"request\";\nimport { Tvmaze } from \"tvmaze-api-ts\";\n\nclass PatchedTvmaze extends Tvmaze {\n  static apiEndpoint = \"https://api.tvmaze.com\";\n\n  constructor() {\n    super();\n\n    this.shows.episodes = (id: string, specials?: boolean) => {\n      let queryString = `/shows/${id}/episodes`;\n\n      if (specials) {\n        queryString += \"?specials=1\";\n      }\n\n      return new Promise((resolve, reject) => {\n        request.get(`${PatchedTvmaze.apiEndpoint}${queryString}`, { json: true }, (err, response) => {\n          if (err) {\n            return reject(err);\n          } else {\n            resolve(response.body);\n          }\n        })\n      });\n    }\n  }\n}\n\nexport const tvmaze = new PatchedTvmaze();\n","import React from \"react\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\n\nimport { Episode, Season, Show } from \"../tvmaze/types\";\nimport { tvmaze } from \"../tvmaze/tvmaze\";\n\ninterface EpisodePickerProps {\n  onChange: (episode?: Episode, nextEpisode?: Episode) => void;\n  nextSeason?: Season;\n  show: Show;\n  season?: Season;\n  selected?: Episode;\n}\n\ninterface EpisodePickerState {\n  isLoading: boolean;\n  results: Episode[];\n  firstEpsiodeNextSeason?: Episode;\n}\n\nexport class EpisodePicker extends React.Component<EpisodePickerProps, EpisodePickerState> {\n  constructor(props: EpisodePickerProps) {\n    super(props);\n\n    this.state = {\n      isLoading: false,\n      results: []\n    };\n\n    this.fetchEpisodes = this.fetchEpisodes.bind(this);\n    this.onChange = this.onChange.bind(this);\n  }\n\n  render() {\n    return (\n      <Typeahead\n        id=\"episode-picker\"\n        clearButton={true}\n        isLoading={this.state.isLoading}\n        labelKey={this.formatEpisodeName}\n        onChange={this.onChange}\n        options={this.state.results}\n        renderMenuItemChildren={episode => {\n          if (episode) {\n            const episodeName = this.formatEpisodeName(episode);\n            return (\n              <div>\n                {episode.image && <img src={episode.image.medium} alt={episodeName}/>}\n                {episodeName}\n              </div>\n            );\n          }\n        }}\n        selected={this.props.selected ? [this.props.selected] : []}\n      />\n    );\n  }\n\n  formatEpisodeName(episode: Episode) {\n    let seasonNumber: string | number = episode.season;\n    if (seasonNumber < 10) {\n      seasonNumber = `0${seasonNumber}`;\n    }\n\n    let episodeNumber: string | number = episode.number;\n    if (episodeNumber < 10) {\n      episodeNumber = `0${episodeNumber || \"0\"}`;\n    }\n\n    return `${seasonNumber}.${episodeNumber} - ${episode.name}`;\n  }\n\n  fetchEpisodes() {\n    const show = this.props.show.id.toString();\n\n    this.setState({isLoading: true});\n\n    if (this.props.season) {\n      tvmaze.shows.seasonEpisodes(this.props.season.id.toString())\n        .then(results => {\n          this.setState({results});\n\n          if (this.props.nextSeason) {\n            tvmaze.shows.episodebynumber(show, this.props.nextSeason.number.toString(), \"1\")\n              .then(firstEpsiodeNextSeason => this.setState({firstEpsiodeNextSeason}))\n              .finally(() => this.setState({isLoading: false}));\n          } else {\n            this.setState({firstEpsiodeNextSeason: undefined, isLoading: false});\n          }\n        }).catch(() => {\n          this.setState({isLoading: false});\n      })\n    } else {\n      tvmaze.shows.episodes(show)\n        .then(results => this.setState({results}))\n        .finally(() => this.setState({isLoading: false}));\n    }\n  }\n\n  onChange(selected: Episode[]) {\n    if (selected.length) {\n      const nextEpisodeIndex = this.state.results.indexOf(selected[0]) + 1;\n\n      if (this.state.results.length <= nextEpisodeIndex) {\n        this.props.onChange(selected[0], this.state.firstEpsiodeNextSeason);\n      } else {\n        this.props.onChange(selected[0], this.state.results[nextEpisodeIndex]);\n      }\n    } else {\n      this.props.onChange();\n    }\n  }\n\n  componentDidMount() {\n    this.fetchEpisodes();\n  }\n\n  componentDidUpdate(prevProps: EpisodePickerProps) {\n    if (this.props.show !== prevProps.show || this.props.season !== prevProps.season) {\n      this.fetchEpisodes();\n    }\n  }\n}\n","import React from \"react\";\nimport { Typeahead } from \"react-bootstrap-typeahead\";\n\nimport { Season, Show } from \"../tvmaze/types\";\nimport { tvmaze } from \"../tvmaze/tvmaze\";\n\ninterface SeasonPickerProps {\n  onChange: (season?: Season, nextSeason?: Season) => void;\n  show: Show;\n  selected?: Season;\n}\n\ninterface SeasonPickerState {\n  isLoading: boolean;\n  results: Season[];\n}\n\nexport class SeasonPicker extends React.Component<SeasonPickerProps, SeasonPickerState> {\n  constructor(props: SeasonPickerProps) {\n    super(props);\n\n    this.state = {\n      isLoading: false,\n      results: []\n    };\n\n    this.fetchSeasons = this.fetchSeasons.bind(this);\n    this.onChange = this.onChange.bind(this);\n  }\n\n  render() {\n    return (\n      <Typeahead\n        id=\"season-picker\"\n        clearButton={true}\n        filterBy={() => true}\n        isLoading={this.state.isLoading}\n        labelKey={this.formatSeasonName}\n        onChange={this.onChange}\n        options={this.state.results}\n        renderMenuItemChildren={season => {\n          const seasonName = this.formatSeasonName(season);\n          return (\n            <div>\n              {season.image && <img src={season.image.medium} alt={seasonName} />}\n              {seasonName}\n            </div>\n          );\n        }}\n        selected={this.props.selected ? [this.props.selected] : []}\n      />\n    );\n  }\n\n  formatSeasonName(season: Season) {\n    return [season.number, season.name].filter(namePart => !!namePart).join(\". \");\n  }\n\n  fetchSeasons() {\n    this.setState({isLoading: true});\n    tvmaze.shows.seasons(this.props.show.id.toString())\n      .then(results => this.setState({results}))\n      .finally(() => this.setState({isLoading: false}));\n  }\n\n  onChange(selected: Season[]) {\n    if (selected.length) {\n      const nextSeasonIndex = this.state.results.indexOf(selected[0]) + 1;\n\n      if (this.state.results.length <= nextSeasonIndex) {\n        this.props.onChange(selected[0]);\n      } else {\n        this.props.onChange(selected[0], this.state.results[nextSeasonIndex]);\n      }\n    } else {\n      this.props.onChange();\n    }\n  }\n\n  componentDidMount() {\n    this.fetchSeasons();\n  }\n\n  componentDidUpdate(prevProps: SeasonPickerProps) {\n    if (this.props.show !== prevProps.show) {\n      this.fetchSeasons();\n    }\n  }\n}\n","import { AsyncTypeahead } from \"react-bootstrap-typeahead\";\nimport React from \"react\";\n\nimport { Show } from \"../tvmaze/types\";\nimport { tvmaze } from \"../tvmaze/tvmaze\";\n\ninterface ShowPickerProps {\n  onChange: (selected: Show) => void;\n  selected?: Show;\n}\n\ninterface ShowPickerState {\n  isLoading: boolean;\n  query: string;\n  results: Show[];\n}\n\nexport class ShowPicker extends React.Component<ShowPickerProps, ShowPickerState> {\n  state = {\n    isLoading: false,\n    query: \"\",\n    results: []\n  };\n\n  render() {\n    return (\n      <AsyncTypeahead\n        id=\"show-picker\"\n        clearButton={true}\n        isLoading={this.state.isLoading}\n        labelKey={(show: Show) => show.name}\n        onSearch={query => {\n          this.setState({isLoading: true});\n          tvmaze.search.shows(query)\n            .then(results => this.setState({results: results.map(show => show.show)}))\n            .finally(() => this.setState({isLoading: false}));\n        }}\n        onChange={selected => this.props.onChange(selected[0])}\n        options={this.state.results}\n        renderMenuItemChildren={show => {\n          return (\n            <div>\n              {show.image && <img src={show.image.medium} alt={show.name} />}\n              {show.name}\n            </div>\n          );\n        }}\n        selected={this.props.selected ? [this.props.selected] : []}\n      />\n    );\n  }\n}\n","import Button from \"react-bootstrap/Button\";\nimport Form from \"react-bootstrap/Form\";\nimport Jumbotron from \"react-bootstrap/Jumbotron\";\nimport React from 'react'\n\nimport { Episode, Season, Show } from \"../tvmaze/types\";\nimport { EpisodePicker } from \"./episode-picker\";\nimport { SeasonPicker } from \"./season-picker\";\nimport { ShowPicker } from \"./show-picker\";\n\ninterface StepOneProps {\n  onEpisodeChange: (episode?: Episode, nextEpisode?: Episode) => void;\n  onNextClick: () => void;\n  episode?: Episode;\n  nextEpisode?: Episode;\n}\n\ninterface StepOneState {\n  nextSeason?: Season;\n  season?: Season;\n  show?: Show;\n}\n\nexport class StepOne extends React.Component<StepOneProps, StepOneState> {\n  constructor(props: StepOneProps) {\n    super(props);\n\n    this.state = {};\n\n    this.onSubmit = this.onSubmit.bind(this);\n  }\n\n  render() {\n    return (\n        <Jumbotron>\n          <Form onSubmit={this.onSubmit}>\n            <Form.Group>\n              <Form.Label>Search for the show you are watching:</Form.Label>\n              <ShowPicker\n                onChange={show => {\n                  this.setState({show, season: undefined});\n                  this.props.onEpisodeChange();\n                }}\n                selected={this.state.show}\n              />\n            </Form.Group>\n            {this.renderSeasonPicker()}\n            {this.renderEpisodePicker()}\n            {this.renderNextButton()}\n          </Form>\n        </Jumbotron>\n    );\n  }\n\n  renderSeasonPicker() {\n    if (this.state.show) {\n      return (\n        <Form.Group>\n          <Form.Label>Select the season you are watching:</Form.Label>\n          <SeasonPicker\n            onChange={(season, nextSeason) => {\n              this.setState({season, nextSeason});\n              this.props.onEpisodeChange();\n            }}\n            selected={this.state.season}\n            show={this.state.show}\n          />\n        </Form.Group>\n      );\n    }\n  }\n\n  renderEpisodePicker() {\n    if (this.state.show) {\n      return (\n        <Form.Group>\n          <Form.Label>Search for the last episode you've seen:</Form.Label>\n          <EpisodePicker\n            nextSeason={this.state.nextSeason}\n            onChange={(episode, nextEpisode) => this.props.onEpisodeChange(episode, nextEpisode)}\n            season={this.state.season}\n            selected={this.props.episode}\n            show={this.state.show}\n          />\n        </Form.Group>\n      );\n    }\n  }\n\n  renderNextButton() {\n    if (this.props.episode) {\n      return (\n        <Button type=\"submit\">Onward, to spoiler free web browsing!</Button>\n      );\n    }\n  }\n\n  onSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    this.props.onNextClick();\n  }\n}\n","import React from \"react\";\n\nimport { Page } from \"../wikimedia/types\";\nimport { Wikimedia } from \"../wikimedia/wikimedia\";\n\ninterface BrowserProps {\n  page: Page;\n  wiki: Wikimedia;\n}\n\ninterface BrowserState {\n  html?: string;\n}\n\nexport class Browser extends React.Component<BrowserProps, BrowserState> {\n  constructor(props: BrowserProps) {\n    super(props);\n\n    this.state = {};\n  }\n\n  render() {\n    if (this.state.html) {\n      return <div dangerouslySetInnerHTML={{__html: this.state.html}} />\n    } else {\n      return \"Loading...\";\n    }\n  }\n\n  componentDidMount() {\n    this.props.wiki.getPage(this.props.page.oldid).then(response => {\n      this.setState({html: JSON.parse(response).parse.text[\"*\"]});\n    });\n  }\n}\n","import Alert from \"react-bootstrap/Alert\";\nimport Button from \"react-bootstrap/Button\";\nimport Form from \"react-bootstrap/Form\";\nimport Jumbotron from \"react-bootstrap/Jumbotron\";\nimport React from \"react\";\nimport Tab from \"react-bootstrap/Tab\";\nimport Tabs from \"react-bootstrap/Tabs\";\n\nimport { Browser } from \"./browser\";\nimport { Episode } from \"../tvmaze/types\";\nimport { Page } from \"../wikimedia/types\";\nimport { Wikimedia } from \"../wikimedia/wikimedia\";\n\nconst wiki = new Wikimedia();\n\ninterface StepTwoProps {\n  episode: Episode;\n  nextEpisode?: Episode;\n}\n\ninterface StepTwoState {\n  pages: Page[];\n  query: string;\n  loading?: boolean;\n  submitted?: boolean;\n}\n\nexport class StepTwo extends React.Component<StepTwoProps, StepTwoState> {\n  constructor(props: StepTwoProps) {\n    super(props);\n\n    this.state = {\n      pages: [],\n      query: \"\"\n    };\n\n    this.onSubmit = this.onSubmit.bind(this);\n  }\n\n  render() {\n    if (this.props.nextEpisode) {\n      return (\n        <React.Fragment>\n          <Jumbotron>\n            <Alert variant=\"primary\">\n              You can browse Wikipedia below without any risk of spoilers beyond episode \"{this.props.episode.name}\".\n            </Alert>\n\n            <Form onSubmit={this.onSubmit}>\n              <Form.Group>\n                <Form.Label>\n                  Search for a Wikipedia article:\n                </Form.Label>\n                <Form.Control value={this.state.query}\n                              onChange={(e: React.ChangeEvent<HTMLInputElement>) => this.setState({\n                                pages: [],\n                                query: e.target.value,\n                                submitted: false\n                              })}/>\n              </Form.Group>\n              <Button variant=\"primary\" type=\"submit\">Search</Button>\n            </Form>\n          </Jumbotron>\n\n          {this.renderTabs()}\n        </React.Fragment>\n      );\n    } else {\n      return (\n        <Jumbotron>\n          <Alert variant=\"danger\">\n            You selected the last episode of the series!  Just go to Wikipedia like a normal person.\n          </Alert>\n        </Jumbotron>\n      );\n    }\n  }\n\n  renderTabs() {\n    if (this.state.pages.length) {\n      return (\n        <Tabs id=\"browser\">\n          {this.state.pages.map(page => {\n            return (\n              <Tab key={page.title} eventKey={page.title} title={page.title}>\n                <Browser page={page} wiki={wiki} />\n              </Tab>\n            );\n          })}\n        </Tabs>\n      );\n    } else if (this.state.loading) {\n      return <Alert variant=\"primary\">Searching...</Alert>;\n    } else if (this.state.submitted) {\n      return <Alert variant=\"danger\">Sorry, no results were found from before the next episode aired :(</Alert>;\n    }\n  }\n\n  onSubmit(e: React.FormEvent) {\n    e.preventDefault();\n\n    this.setState({loading: true, submitted: true});\n\n    wiki.search(this.state.query).then(searchResponse => {\n      const results = JSON.parse(searchResponse);\n\n      if (results.query.search.length) {\n        results.query.search.forEach((page: Page) => {\n          const date = new Date(this.props.nextEpisode!.airstamp);\n          date.setDate(date.getDate() - 1);\n\n          wiki.getRevision(page.title, date.toISOString()).then(getRevisionResponse => {\n            const pages = JSON.parse(getRevisionResponse).query.pages;\n            const revisions = pages[Object.keys(pages)[0]].revisions;\n\n            if (revisions && revisions.length) {\n              this.setState({pages: this.state.pages.concat([{title: page.title, oldid: revisions[0].revid}])});\n            }\n          }).finally(() => {\n            this.setState({loading: false});\n          });\n        });\n      }\n    }).catch(() => {\n      this.setState({loading: false});\n    });\n  }\n}\n","import rp from \"request-promise-native\";\n\nexport class Wikimedia {\n  endpoint = \"https://en.wikipedia.org/w/api.php\";\n\n  constructor(options?: {endpoint?: string}) {\n    this.endpoint = options && options.endpoint ? options.endpoint : this.endpoint;\n  }\n\n  search(query: string) {\n    return rp.get({\n      uri: this.endpoint,\n      qs: {\n        origin: \"*\",\n        action: \"query\",\n        list: \"search\",\n        srsearch: query,\n        format: \"json\"\n      }\n    });\n  }\n\n  getRevision(title: string, before: string) {\n    return rp.get({\n      uri: this.endpoint,\n      qs: {\n        origin: \"*\",\n        action: \"query\",\n        prop: \"revisions\",\n        titles: title,\n        rvprop: \"ids\",\n        rvstart: before,\n        rvlimit: 1,\n        format: \"json\"\n      }\n    });\n  }\n\n  getPage(oldid: number) {\n    return rp.get({\n      uri: this.endpoint,\n      qs: {\n        origin: \"*\",\n        action: \"parse\",\n        format: \"json\",\n        oldid\n      }\n    });\n  }\n}\n","import React from 'react'\nimport Tab from \"react-bootstrap/Tab\";\nimport Tabs from \"react-bootstrap/Tabs\";\n\nimport { Episode } from \"./tvmaze/types\";\nimport { StepOne } from \"./step-one/step-one\";\nimport { StepTwo } from \"./step-two/step-two\";\n\nimport './App.css';\n\ninterface AppProps {}\n\ninterface AppState {\n  activeKey: string;\n  episode?: Episode;\n  nextEpisode?: Episode;\n}\n\nclass App extends React.Component<AppProps, AppState> {\n  constructor(props: AppProps) {\n    super(props);\n\n    this.state = {\n      activeKey: \"step-one\"\n    };\n  }\n\n  render() {\n    return (\n      <Tabs id=\"app\" activeKey={this.state.activeKey} onSelect={(activeKey: string) => this.setState({activeKey})}>\n        <Tab eventKey=\"step-one\" title=\"Episode Picker\">\n          <StepOne\n            onEpisodeChange={(episode, nextEpisode) => this.setState({episode, nextEpisode})}\n            episode={this.state.episode}\n            onNextClick={() => this.setState({activeKey: \"step-two\"})}\n          />\n        </Tab>\n        <Tab eventKey=\"step-two\" title=\"Wikipedia\" disabled={!this.state.episode}>\n          {this.state.episode && <StepTwo episode={this.state.episode} nextEpisode={this.state.nextEpisode} />}\n        </Tab>\n      </Tabs>\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport \"react-bootstrap-typeahead/css/Typeahead.min.css\";\nimport \"react-bootstrap-typeahead/css/Typeahead-bs4.min.css\";\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}