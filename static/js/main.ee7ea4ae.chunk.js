(this.webpackJsonpnospoilers=this.webpackJsonpnospoilers||[]).push([[0],{378:function(e,t,n){e.exports=n(846)},383:function(e,t,n){},532:function(e,t){},534:function(e,t){},564:function(e,t){},565:function(e,t){},609:function(e,t){},611:function(e,t){},634:function(e,t){},751:function(e,t){},842:function(e,t,n){},846:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),i=n(38),o=n.n(i),r=(n(383),n(19)),c=n(22),u=n(24),l=n(23),h=n(25),p=n(101),d=n(141),f=n(28),m=n(135),g=n(30),v=n(100),b=n(70),y=n(134),E=n.n(y),S=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(u.a)(this,Object(l.a)(t).call(this))).shows.episodes=function(e,n){var a="/shows/".concat(e,"/episodes");return n&&(a+="?specials=1"),new Promise((function(e,n){E.a.get("".concat(t.apiEndpoint).concat(a),{json:!0},(function(t,a){if(t)return n(t);e(a.body)}))}))},e}return Object(h.a)(t,e),t}(n(376).Tvmaze);S.apiEndpoint="https://api.tvmaze.com";var k=new S,w=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={isLoading:!1,results:[]},n.fetchEpisodes=n.fetchEpisodes.bind(Object(f.a)(n)),n.onChange=n.onChange.bind(Object(f.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(b.Typeahead,{id:"episode-picker",clearButton:!0,isLoading:this.state.isLoading,labelKey:this.formatEpisodeName,onChange:this.onChange,options:this.state.results,renderMenuItemChildren:function(t){if(t){var n=e.formatEpisodeName(t);return s.a.createElement("div",null,t.image&&s.a.createElement("img",{src:t.image.medium,alt:n}),n)}},selected:this.props.selected?[this.props.selected]:[]})}},{key:"formatEpisodeName",value:function(e){var t=e.season;t<10&&(t="0".concat(t));var n=e.number;return n<10&&(n="0".concat(n||"0")),"".concat(t,".").concat(n," - ").concat(e.name)}},{key:"fetchEpisodes",value:function(){var e=this,t=this.props.show.id.toString();this.setState({isLoading:!0}),this.props.season?k.shows.seasonEpisodes(this.props.season.id.toString()).then((function(n){e.setState({results:n}),e.props.nextSeason?k.shows.episodebynumber(t,e.props.nextSeason.number.toString(),"1").then((function(t){return e.setState({firstEpsiodeNextSeason:t})})).finally((function(){return e.setState({isLoading:!1})})):e.setState({firstEpsiodeNextSeason:void 0,isLoading:!1})})).catch((function(){e.setState({isLoading:!1})})):k.shows.episodes(t).then((function(t){return e.setState({results:t})})).finally((function(){return e.setState({isLoading:!1})}))}},{key:"onChange",value:function(e){if(e.length){var t=this.state.results.indexOf(e[0])+1;this.state.results.length<=t?this.props.onChange(e[0],this.state.firstEpsiodeNextSeason):this.props.onChange(e[0],this.state.results[t])}else this.props.onChange()}},{key:"componentDidMount",value:function(){this.fetchEpisodes()}},{key:"componentDidUpdate",value:function(e){this.props.show===e.show&&this.props.season===e.season||this.fetchEpisodes()}}]),t}(s.a.Component),O=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={isLoading:!1,results:[]},n.fetchSeasons=n.fetchSeasons.bind(Object(f.a)(n)),n.onChange=n.onChange.bind(Object(f.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(b.Typeahead,{id:"season-picker",clearButton:!0,filterBy:function(){return!0},isLoading:this.state.isLoading,labelKey:this.formatSeasonName,onChange:this.onChange,options:this.state.results,renderMenuItemChildren:function(t){var n=e.formatSeasonName(t);return s.a.createElement("div",null,t.image&&s.a.createElement("img",{src:t.image.medium,alt:n}),n)},selected:this.props.selected?[this.props.selected]:[]})}},{key:"formatSeasonName",value:function(e){return[e.number,e.name].filter((function(e){return!!e})).join(". ")}},{key:"fetchSeasons",value:function(){var e=this;this.setState({isLoading:!0}),k.shows.seasons(this.props.show.id.toString()).then((function(t){return e.setState({results:t})})).finally((function(){return e.setState({isLoading:!1})}))}},{key:"onChange",value:function(e){if(e.length){var t=this.state.results.indexOf(e[0])+1;this.state.results.length<=t?this.props.onChange(e[0]):this.props.onChange(e[0],this.state.results[t])}else this.props.onChange()}},{key:"componentDidMount",value:function(){this.fetchSeasons()}},{key:"componentDidUpdate",value:function(e){this.props.show!==e.show&&this.fetchSeasons()}}]),t}(s.a.Component),j=function(e){function t(){var e,n;Object(r.a)(this,t);for(var a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(s)))).state={isLoading:!1,query:"",results:[]},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(b.AsyncTypeahead,{id:"show-picker",clearButton:!0,isLoading:this.state.isLoading,labelKey:function(e){return e.name},onSearch:function(t){e.setState({isLoading:!0}),k.search.shows(t).then((function(t){return e.setState({results:t.map((function(e){return e.show}))})})).finally((function(){return e.setState({isLoading:!1})}))},onChange:function(t){return e.props.onChange(t[0])},options:this.state.results,renderMenuItemChildren:function(e){return s.a.createElement("div",null,e.image&&s.a.createElement("img",{src:e.image.medium,alt:e.name}),e.name)},selected:this.props.selected?[this.props.selected]:[]})}}]),t}(s.a.Component),C=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n.onSubmit=n.onSubmit.bind(Object(f.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(v.a,null,s.a.createElement(g.a,{onSubmit:this.onSubmit},s.a.createElement(g.a.Group,null,s.a.createElement(g.a.Label,null,"Search for the show you are watching:"),s.a.createElement(j,{onChange:function(t){e.setState({show:t,season:void 0}),e.props.onEpisodeChange()},selected:this.state.show})),this.renderSeasonPicker(),this.renderEpisodePicker(),this.renderNextButton()))}},{key:"renderSeasonPicker",value:function(){var e=this;if(this.state.show)return s.a.createElement(g.a.Group,null,s.a.createElement(g.a.Label,null,"Select the season you are watching:"),s.a.createElement(O,{onChange:function(t,n){e.setState({season:t,nextSeason:n}),e.props.onEpisodeChange()},selected:this.state.season,show:this.state.show}))}},{key:"renderEpisodePicker",value:function(){var e=this;if(this.state.show)return s.a.createElement(g.a.Group,null,s.a.createElement(g.a.Label,null,"Search for the last episode you've seen:"),s.a.createElement(w,{nextSeason:this.state.nextSeason,onChange:function(t,n){return e.props.onEpisodeChange(t,n)},season:this.state.season,selected:this.props.episode,show:this.state.show}))}},{key:"renderNextButton",value:function(){if(this.props.episode)return s.a.createElement(m.a,{type:"submit"},"Onward, to spoiler free web browsing!")}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onNextClick()}}]),t}(s.a.Component),L=n(102),x=n(211),N=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return this.state.html?s.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.state.html}}):"Loading..."}},{key:"componentDidMount",value:function(){var e=this;this.props.wiki.getPage(this.props.page.oldid).then((function(t){var n=JSON.parse(t);n.parse&&e.setState({html:n.parse.text["*"]})}))}}]),t}(s.a.Component),q=n(142),P=n.n(q),K=new(function(){function e(t){Object(r.a)(this,e),this.endpoint="https://en.wikipedia.org/w/api.php",this.endpoint=t&&t.endpoint?t.endpoint:this.endpoint}return Object(c.a)(e,[{key:"search",value:function(e){return P.a.get({uri:this.endpoint,qs:{origin:"*",action:"query",list:"search",srsearch:e,format:"json"}})}},{key:"getRevision",value:function(e,t){return P.a.get({uri:this.endpoint,qs:{origin:"*",action:"query",prop:"revisions",titles:e,rvprop:"ids",rvstart:t,rvlimit:1,format:"json"}})}},{key:"getPage",value:function(e){return P.a.get({uri:this.endpoint,qs:{origin:"*",action:"parse",format:"json",oldid:e}})}}]),e}()),D=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={pages:[],query:"",toastVisible:!1},n.onClick=n.onClick.bind(Object(f.a)(n)),n.onSubmit=n.onSubmit.bind(Object(f.a)(n)),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return this.props.nextEpisode?s.a.createElement(s.a.Fragment,null,s.a.createElement(x.a,{show:this.state.toastVisible,onClose:function(){return e.setState({toastVisible:!1})},autohide:!0},s.a.createElement(x.a.Body,{onClick:function(){return window.scrollTo(0,0)},className:"alert-primary"},"New tab opened!  Click here to scroll up.")),s.a.createElement(v.a,null,s.a.createElement(L.a,{variant:"primary"},'You can browse Wikipedia below without any risk of spoilers beyond episode "',this.props.episode.name,'".'),s.a.createElement(g.a,{onSubmit:this.onSubmit},s.a.createElement(g.a.Group,null,s.a.createElement(g.a.Label,null,"Search for a Wikipedia article:"),s.a.createElement(g.a.Control,{value:this.state.query,onChange:function(t){return e.setState({pages:[],query:t.target.value,submitted:!1})}})),s.a.createElement(m.a,{disabled:this.state.loading,variant:"primary",type:"submit"},"Search"))),this.renderTabs()):s.a.createElement(v.a,null,s.a.createElement(L.a,{variant:"danger"},"You selected the last episode of the series!  Just go to Wikipedia like a normal person."))}},{key:"renderTabs",value:function(){return this.state.pages.length?s.a.createElement(d.a,{id:"browser"},this.state.pages.map((function(e){return s.a.createElement(p.a,{key:e.title,eventKey:e.title,title:e.title},s.a.createElement(N,{page:e,wiki:K}))}))):this.state.loading?s.a.createElement(L.a,{variant:"primary"},"Searching..."):this.state.submitted?s.a.createElement(L.a,{variant:"danger"},"Sorry, no results were found from before the next episode aired :("):void 0}},{key:"fetchPage",value:function(e){var t=this;if(!this.state.pages.find((function(t){return t.title===e})))return K.getRevision(e,this.props.nextEpisode.airstamp).then((function(n){var a=JSON.parse(n).query.pages,s=a[Object.keys(a)[0]].revisions;s&&s.length&&t.setState({pages:t.state.pages.concat([{title:e,oldid:s[0].revid}])})}))}},{key:"onSubmit",value:function(e){var t=this;e.preventDefault(),this.state.loading||(this.setState({loading:!0,pages:[],submitted:!0}),K.search(this.state.query).then((function(e){var n=JSON.parse(e);n.query.search.length&&Promise.all(n.query.search.map((function(e){return t.fetchPage(e.title)}))).finally((function(){return t.setState({loading:!1})}))})).catch((function(){t.setState({loading:!1})})))}},{key:"onClick",value:function(e){var t=this,n=e.target;if("A"===n.tagName){var a=n;if(a.pathname.startsWith("/wiki/")){var s=this.fetchPage(a.pathname.substring(6).replace(/_/g," "));s&&s.then((function(){return t.setState({toastVisible:!0})}))}else a.href.startsWith(window.location.origin)||window.open(a.href,"_blank");e.preventDefault()}}},{key:"componentDidMount",value:function(){window.addEventListener("click",this.onClick)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("click",this.onClick)}}]),t}(s.a.Component),B=(n(842),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={activeKey:"step-one"},n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(d.a,{id:"app",activeKey:this.state.activeKey,onSelect:function(t){return e.setState({activeKey:t})}},s.a.createElement(p.a,{eventKey:"step-one",title:"Episode Picker"},s.a.createElement(C,{onEpisodeChange:function(t,n){return e.setState({episode:t,nextEpisode:n})},episode:this.state.episode,onNextClick:function(){return e.setState({activeKey:"step-two"})}})),s.a.createElement(p.a,{eventKey:"step-two",title:"Wikipedia",disabled:!this.state.episode},this.state.episode&&s.a.createElement(D,{episode:this.state.episode,nextEpisode:this.state.nextEpisode})))}}]),t}(s.a.Component));n(843),n(844),n(845);o.a.render(s.a.createElement(B,null),document.getElementById("root"))}},[[378,1,2]]]);
//# sourceMappingURL=main.ee7ea4ae.chunk.js.map