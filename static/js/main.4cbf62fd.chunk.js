(this.webpackJsonpnospoilers=this.webpackJsonpnospoilers||[]).push([[0],{376:function(e,t,n){e.exports=n(844)},381:function(e,t,n){},530:function(e,t){},532:function(e,t){},562:function(e,t){},563:function(e,t){},607:function(e,t){},609:function(e,t){},632:function(e,t){},749:function(e,t){},840:function(e,t,n){},844:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),i=n(38),o=n.n(i),r=(n(381),n(19)),c=n(22),u=n(24),h=n(23),l=n(25),p=n(98),d=n(139),f=n(33),m=n(133),g=n(29),v=n(97),b=n(69),y=n(132),S=n.n(y),E=function(e){function t(){var e;return Object(r.a)(this,t),(e=Object(u.a)(this,Object(h.a)(t).call(this))).shows.episodes=function(e,n){var a="/shows/".concat(e,"/episodes");return n&&(a+="?specials=1"),new Promise((function(e,n){S.a.get("".concat(t.apiEndpoint).concat(a),{json:!0},(function(t,a){if(t)return n(t);e(a.body)}))}))},e}return Object(l.a)(t,e),t}(n(374).Tvmaze);E.apiEndpoint="https://api.tvmaze.com";var O=new E,j=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(h.a)(t).call(this,e))).state={isLoading:!1,results:[]},n.fetchEpisodes=n.fetchEpisodes.bind(Object(f.a)(n)),n.onChange=n.onChange.bind(Object(f.a)(n)),n}return Object(l.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(b.Typeahead,{id:"episode-picker",clearButton:!0,isLoading:this.state.isLoading,labelKey:this.formatEpisodeName,onChange:this.onChange,options:this.state.results,renderMenuItemChildren:function(t){if(t){var n=e.formatEpisodeName(t);return s.a.createElement("div",null,t.image&&s.a.createElement("img",{src:t.image.medium,alt:n}),n)}},selected:this.props.selected?[this.props.selected]:[]})}},{key:"formatEpisodeName",value:function(e){var t=e.season;t<10&&(t="0".concat(t));var n=e.number;return n<10&&(n="0".concat(n||"0")),"".concat(t,".").concat(n," - ").concat(e.name)}},{key:"fetchEpisodes",value:function(){var e=this,t=this.props.show.id.toString();this.setState({isLoading:!0}),this.props.season?O.shows.seasonEpisodes(this.props.season.id.toString()).then((function(n){e.setState({results:n}),e.props.nextSeason?O.shows.episodebynumber(t,e.props.nextSeason.number.toString(),"1").then((function(t){return e.setState({firstEpsiodeNextSeason:t})})).finally((function(){return e.setState({isLoading:!1})})):e.setState({firstEpsiodeNextSeason:void 0,isLoading:!1})})).catch((function(){e.setState({isLoading:!1})})):O.shows.episodes(t).then((function(t){return e.setState({results:t})})).finally((function(){return e.setState({isLoading:!1})}))}},{key:"onChange",value:function(e){if(e.length){var t=this.state.results.indexOf(e[0])+1;this.state.results.length<=t?this.props.onChange(e[0],this.state.firstEpsiodeNextSeason):this.props.onChange(e[0],this.state.results[t])}else this.props.onChange()}},{key:"componentDidMount",value:function(){this.fetchEpisodes()}},{key:"componentDidUpdate",value:function(e){this.props.show===e.show&&this.props.season===e.season||this.fetchEpisodes()}}]),t}(s.a.Component),k=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(h.a)(t).call(this,e))).state={isLoading:!1,results:[]},n.fetchSeasons=n.fetchSeasons.bind(Object(f.a)(n)),n.onChange=n.onChange.bind(Object(f.a)(n)),n}return Object(l.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(b.Typeahead,{id:"season-picker",clearButton:!0,filterBy:function(){return!0},isLoading:this.state.isLoading,labelKey:this.formatSeasonName,onChange:this.onChange,options:this.state.results,renderMenuItemChildren:function(t){var n=e.formatSeasonName(t);return s.a.createElement("div",null,t.image&&s.a.createElement("img",{src:t.image.medium,alt:n}),n)},selected:this.props.selected?[this.props.selected]:[]})}},{key:"formatSeasonName",value:function(e){return[e.number,e.name].filter((function(e){return!!e})).join(". ")}},{key:"fetchSeasons",value:function(){var e=this;this.setState({isLoading:!0}),O.shows.seasons(this.props.show.id.toString()).then((function(t){return e.setState({results:t})})).finally((function(){return e.setState({isLoading:!1})}))}},{key:"onChange",value:function(e){if(e.length){var t=this.state.results.indexOf(e[0])+1;this.state.results.length<=t?this.props.onChange(e[0]):this.props.onChange(e[0],this.state.results[t])}else this.props.onChange()}},{key:"componentDidMount",value:function(){this.fetchSeasons()}},{key:"componentDidUpdate",value:function(e){this.props.show!==e.show&&this.fetchSeasons()}}]),t}(s.a.Component),w=function(e){function t(){var e,n;Object(r.a)(this,t);for(var a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(s)))).state={isLoading:!1,query:"",results:[]},n}return Object(l.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(b.AsyncTypeahead,{id:"show-picker",clearButton:!0,isLoading:this.state.isLoading,labelKey:function(e){return e.name},onSearch:function(t){e.setState({isLoading:!0}),O.search.shows(t).then((function(t){return e.setState({results:t.map((function(e){return e.show}))})})).finally((function(){return e.setState({isLoading:!1})}))},onChange:function(t){return e.props.onChange(t[0])},options:this.state.results,renderMenuItemChildren:function(e){return s.a.createElement("div",null,e.image&&s.a.createElement("img",{src:e.image.medium,alt:e.name}),e.name)},selected:this.props.selected?[this.props.selected]:[]})}}]),t}(s.a.Component),C=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(h.a)(t).call(this,e))).state={},n.onSubmit=n.onSubmit.bind(Object(f.a)(n)),n}return Object(l.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(v.a,null,s.a.createElement(g.a,{onSubmit:this.onSubmit},s.a.createElement(g.a.Group,null,s.a.createElement(g.a.Label,null,"Search for the show you are watching:"),s.a.createElement(w,{onChange:function(t){e.setState({show:t,season:void 0}),e.props.onEpisodeChange()},selected:this.state.show})),this.renderSeasonPicker(),this.renderEpisodePicker(),this.renderNextButton()))}},{key:"renderSeasonPicker",value:function(){var e=this;if(this.state.show)return s.a.createElement(g.a.Group,null,s.a.createElement(g.a.Label,null,"Select the season you are watching:"),s.a.createElement(k,{onChange:function(t,n){e.setState({season:t,nextSeason:n}),e.props.onEpisodeChange()},selected:this.state.season,show:this.state.show}))}},{key:"renderEpisodePicker",value:function(){var e=this;if(this.state.show)return s.a.createElement(g.a.Group,null,s.a.createElement(g.a.Label,null,"Search for the last episode you've seen:"),s.a.createElement(j,{nextSeason:this.state.nextSeason,onChange:function(t,n){return e.props.onEpisodeChange(t,n)},season:this.state.season,selected:this.props.episode,show:this.state.show}))}},{key:"renderNextButton",value:function(){if(this.props.episode)return s.a.createElement(m.a,{type:"submit"},"Onward, to spoiler free web browsing!")}},{key:"onSubmit",value:function(e){e.preventDefault(),this.props.onNextClick()}}]),t}(s.a.Component),L=n(100),x=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(h.a)(t).call(this,e))).state={},n}return Object(l.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return this.state.html?s.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.state.html}}):"Loading..."}},{key:"componentDidMount",value:function(){var e=this;this.props.wiki.getPage(this.props.page.oldid).then((function(t){e.setState({html:JSON.parse(t).parse.text["*"]})}))}}]),t}(s.a.Component),N=n(141),q=n.n(N),K=new(function(){function e(t){Object(r.a)(this,e),this.endpoint="https://en.wikipedia.org/w/api.php",this.endpoint=t&&t.endpoint?t.endpoint:this.endpoint}return Object(c.a)(e,[{key:"search",value:function(e){return q.a.get({uri:this.endpoint,qs:{origin:"*",action:"query",list:"search",srsearch:e,format:"json"}})}},{key:"getRevision",value:function(e,t){return q.a.get({uri:this.endpoint,qs:{origin:"*",action:"query",prop:"revisions",titles:e,rvprop:"ids",rvstart:t,rvlimit:1,format:"json"}})}},{key:"getPage",value:function(e){return q.a.get({uri:this.endpoint,qs:{origin:"*",action:"parse",format:"json",oldid:e}})}}]),e}()),D=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(h.a)(t).call(this,e))).state={pages:[],query:""},n.onSubmit=n.onSubmit.bind(Object(f.a)(n)),n}return Object(l.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return this.props.nextEpisode?s.a.createElement(s.a.Fragment,null,s.a.createElement(v.a,null,s.a.createElement(L.a,{variant:"primary"},'You can browse Wikipedia below without any risk of spoilers beyond episode "',this.props.episode.name,'".'),s.a.createElement(g.a,{onSubmit:this.onSubmit},s.a.createElement(g.a.Group,null,s.a.createElement(g.a.Label,null,"Search for a Wikipedia article:"),s.a.createElement(g.a.Control,{value:this.state.query,onChange:function(t){return e.setState({pages:[],query:t.target.value,submitted:!1})}})),s.a.createElement(m.a,{variant:"primary",type:"submit"},"Search"))),this.renderTabs()):s.a.createElement(v.a,null,s.a.createElement(L.a,{variant:"danger"},"You selected the last episode of the series!  Just go to Wikipedia like a normal person."))}},{key:"renderTabs",value:function(){return this.state.pages.length?s.a.createElement(d.a,{id:"browser"},this.state.pages.map((function(e){return s.a.createElement(p.a,{key:e.title,eventKey:e.title,title:e.title},s.a.createElement(x,{page:e,wiki:K}))}))):this.state.loading?s.a.createElement(L.a,{variant:"primary"},"Searching..."):this.state.submitted?s.a.createElement(L.a,{variant:"danger"},"Sorry, no results were found from before the next episode aired :("):void 0}},{key:"onSubmit",value:function(e){var t=this;e.preventDefault(),this.setState({loading:!0,submitted:!0}),K.search(this.state.query).then((function(e){var n=JSON.parse(e);n.query.search.length&&n.query.search.forEach((function(e){var n=new Date(t.props.nextEpisode.airstamp);n.setDate(n.getDate()-1),K.getRevision(e.title,n.toISOString()).then((function(n){var a=JSON.parse(n).query.pages,s=a[Object.keys(a)[0]].revisions;s&&s.length&&t.setState({pages:t.state.pages.concat([{title:e.title,oldid:s[0].revid}])})})).finally((function(){t.setState({loading:!1})}))}))})).catch((function(){t.setState({loading:!1})}))}}]),t}(s.a.Component),P=(n(840),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(h.a)(t).call(this,e))).state={activeKey:"step-one"},n}return Object(l.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(d.a,{id:"app",activeKey:this.state.activeKey,onSelect:function(t){return e.setState({activeKey:t})}},s.a.createElement(p.a,{eventKey:"step-one",title:"Episode Picker"},s.a.createElement(C,{onEpisodeChange:function(t,n){return e.setState({episode:t,nextEpisode:n})},episode:this.state.episode,onNextClick:function(){return e.setState({activeKey:"step-two"})}})),s.a.createElement(p.a,{eventKey:"step-two",title:"Wikipedia",disabled:!this.state.episode},this.state.episode&&s.a.createElement(D,{episode:this.state.episode,nextEpisode:this.state.nextEpisode})))}}]),t}(s.a.Component));n(841),n(842),n(843);o.a.render(s.a.createElement(P,null),document.getElementById("root"))}},[[376,1,2]]]);
//# sourceMappingURL=main.4cbf62fd.chunk.js.map